{% extends "base.html" %}
{% load static %}
{% block content %}
    <div class="container" id="hero-image">
        {% include 'main-nav.html' %}
        <div class="row align-items-center mx-auto" id="storefront">
            <div class="col">
                <div class="row no-gutters mx-auto my-auto" id="store-items">
                    <div class="col-md-4 store-item">
                        <div class="row hidden-rows">
                            <div class="col info-section">
                                <img src="{% static 'hardwoods.jpeg' %}" alt="" class="hidden-items active-hidden-img">
                                <h1 class="store-text">Hard Woods</h1>
                                <p class="hidden-items active-hidden-items hidden-paragraph">
                                    Hardwoods come from slow-growing trees like oak, maple, cherry and birch. They make ideal firewood, burning longer and hotter than softwoods. On average, you'll use twice as much softwood to get the same heat from hardwoods! They are more expensive due to the much longer time it takes to mature as a tree, and dry in the kiln.
                                </p>
                            </div>
                            <div class="col-lg-6 col-md-12 hidden-items text-black px-4">
                                <form action="" class="form" method="POST">
                                    {% csrf_token %}
                                    <div class="form-row my-auto">
                                        <div class="col-12">
                                            <p><strong>Pickup or Delivery?</strong></p>
                                            <select name="delivery_method" class="form-control rounded-0" id="id_delivery_method">
                                                <option value="" selected>Select delivery method</option>
                                                <option value="pickup">Pick up from Bark Farmers</option>
                                                <option value="delivery">My Home Delivery</option>
                                            </select>
                                        </div>
                                        <div class="col-12">
                                            <p><strong>How do you want your wood?</strong></p>
                                            <select name="product_type" class="form-control rounded-0" id="id_product_type">
                                                <option value="bag" selected>Construction Bag</option>
                                                <option value="stacked">Hand-stacked</option>
                                                <option value="bundles">Bundles</option>
                                                <option value="pile">Loose pile</option>
                                            </select>
                                        </div>
                                        <p><strong>How much do you want?</strong></p>
                                        <div class="input-group">
                                            <div class="input-group-prepend">
                                                <button class="decrement-qty btn-dark btn-sm btn-black rounded-0" data-item_id="{{ item.item_id }}" id="decrement-qty_{{ item.item_id }}">
                                                    <span><i class="fas fa-minus fa-sm"></i></span>
                                                </button>
                                            </div>
                                            <input type="number" name="quantity" value="1" min="1" max="99" data-item_id="{{ product.id }}" id="id_qty_{{ product.id }}" class="form-control qty_input">
                                            <div class="input-group-append">
                                                <button class="increment-qty btn-dark btn-sm btn-black rounded-0" data-item_id="{{ item.item_id }}" id="increment-qty_{{ item.item_id }}">
                                                    <span><i class="fas fa-plus fa-sm"></i></span>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-12">
                                        </div>
                                    </div>
                                    {% include 'checkout.html' %}
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 store-item">
                        <div class="row hidden-rows">
                            <div class="col info-section">
                                <img src="{% static 'softwoods.jpg' %}" alt="" class="hidden-items active-hidden-img">
                                <h1 class="store-text">Soft Woods</h1>
                                <p class="hidden-items active-hidden-items hidden-paragraph">
                                    Softwoods come from fast-growing trees like pine, larch and fir. They are easy to dry and cure, which is why they're cheaper. They are faster-burning and easier to light than hardwoods. Uncured softwoods create unwanted sparks and smoke, which is why Bark Farmers sells only reliable, kiln-dried softwoods.
                                </p>
                            </div>
                            <div class="col-lg-6 col-md-12 hidden-items">
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 store-item">
                        <div class="row hidden-rows">
                            <div class="col info-section">
                                <img src="{% static 'cookingwoods.jpg' %}" alt="" class="hidden-items active-hidden-img">
                                <h1 class="store-text">Cooking Woods</h1>
                                <p class="hidden-items active-hidden-items hidden-paragraph">
                                    Milder cooking woods come from fruit trees like apple, peach and cherry, while middle-strength come from specific hardwoods like hickory, maple and pecan. Bark farmers' cooking woods are available based on our limited supply of these premium woods to process.
                                </p>
                            </div>
                            <div class="col-lg-6 col-md-12 hidden-items">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script type="text/javascript">
        function handleEnableDisable(itemId) {
            var currentValue = parseInt($(`#id_qty_${itemId}`).val())
            var minusDisabled = currentValue < 2;
            var plusDisabled = currentValue > 98;
            $(`#decrement-qty_${itemId}`).prop("disabled", minusDisabled);
            $(`#increment-qty_${itemId}`).prop("disabled", plusDisabled);
        }
        $('.increment-qty').click(function(e) {
            e.preventDefault();
            var closestInput = $(this).closest('.input-group').find('.qty_input')[0];
            var currentValue = parseInt($(closestInput).val());
            $(closestInput).val(currentValue + 1);
            var itemId = $(this).data("item_id");
            handleEnableDisable(itemId);
        });
    
        $('.decrement-qty').click(function(e){
            e.preventDefault();
            var closestInput = $(this).closest('.input-group').find(".qty_input")[0];
            var currentValue = parseInt($(closestInput).val());
            $(closestInput).val(currentValue - 1);
            var itemId = $(this).data("item_id");
            handleEnableDisable(itemId);
        })

        var storeItems = document.getElementsByClassName("info-section"); 
        var vertical;

        // Reorient is used by the event listeners to re-orient the bootstrap layout to a vertical one if the screen is taller than wide (i.e. tablets)
        let reOrient = function() {

            // Transition to portrait mode
            if (window.innerHeight > window.innerWidth) {
                if (vertical === false) {
                    vertical = true;
                }
                for (let i = 0; i < storeItems.length; i++){
                    let storeItem = storeItems[i].parentNode.parentNode
                    let classes = storeItem.classList
                    let headerText = storeItems[i].firstElementChild.nextElementSibling
                    storeItems[i].firstElementChild.nextElementSibling.setAttribute("class", "store-text-portrait");
                    if (classes.contains("active-store-item-portrait") || classes.contains("col-md-10")) {
                        storeItem.setAttribute("class", "col-md-12 active-store-item-portrait");
                        headerText.classList.add("active-text")

                    } else if (classes.contains("minimized-store-item-portrait") || classes.contains("col-md-1")) {
                        storeItem.setAttribute("class", "col-md-12 store-item minimized-store-item-portrait")

                        headerText.classList.remove("minimized-text", "store-text-portrait")
                        headerText.classList.add("store-text-minimized-portrait")
                    } else {
                        storeItem.setAttribute("class", "col-md-12 store-item-portrait");
                    }
                }

            // Transition to landscape mode
            } else {
                if (vertical === true) {
                    vertical = false;
                }
                for (let i = 0; i < storeItems.length; i++){
                    let storeItem = storeItems[i].parentNode.parentNode
                    let classes = storeItem.classList
                    if (classes.contains("active-store-item-portrait") || classes.contains("col-md-10")) {
                        storeItems[i].parentNode.parentNode.setAttribute("class", "col-md-10 active-store-item");
                    } else if (classes.contains("minimized-store-item-portrait") || classes.contains("col-md-1")) {
                        storeItems[i].parentNode.parentNode.setAttribute("class", "col-md-1 store-item");
                        storeItems[i].firstElementChild.nextElementSibling.classList.add("minimized-text")
                    } else {
                        storeItems[i].parentNode.parentNode.setAttribute("class", "col-md-4 store-item");
                    }
                    storeItems[i].firstElementChild.nextElementSibling.classList.remove("store-text-portrait");
                    storeItems[i].firstElementChild.nextElementSibling.classList.add("store-text");
                }
            }
        }

        window.addEventListener("load", function() {
            if (window.innerHeight > window.innerWidth){
                vertical = true;
            } else {
                vertical = false;
            }
        })
        window.addEventListener("resize", reOrient);
        window.addEventListener("load", reOrient);

        // Thanks to https://www.javascripttutorial.net/javascript-dom/javascript-siblings/ for this
        // Get siblings function
        let getSiblings = function (e) {
            // for collecting siblingsza
            let siblings = [];
            // if no parent, return no sibling
            if(!e.parentNode) {
                return siblings;
            }
            // first child of the parent node
            let sibling  = e.parentNode.firstChild;
            
            // collecting siblings
            while (sibling) {
                if (sibling.nodeType === 1 && sibling !== e) {
                    siblings.push(sibling);
                }
                sibling = sibling.nextSibling;
            }
            return siblings;
        };


        // Minimizing and displaying store items
        for (let t = 0; t < storeItems.length; t++) {
            storeItems[t].addEventListener("click", function(event) {
                // Portait
                if (vertical === true) {
                    let collapse = event.target.parentNode.parentNode;
                    let siblings = getSiblings(collapse);

                    // Other sections being hidden
                    for (let x = 0; x < siblings.length; x++) {
                        siblings[x].setAttribute("class", "col-md-12 store-item minimized-store-item-portrait")

                        let hideElements = siblings[x].firstElementChild.firstElementChild;

                        let headerHide = hideElements.firstElementChild.nextElementSibling;
                        headerHide.classList.remove("active-text", "store-text-portrait");
                        headerHide.classList.add("store-text-portrait-minimized");

                        let paragraphHide = hideElements.lastElementChild;
                        paragraphHide.classList.add("hidden-items");

                        let imageHide = hideElements.firstElementChild;
                        imageHide.classList.add("hidden-items");

                        let formHide = hideElements.parentNode.lastElementChild;
                        formHide.classList.add("hidden-items");
                        }
                    
                    // Sections being revealed
                    collapse.setAttribute("class", "col-md-12 active-store-item-portrait");
                    
                    console.log(event.target)
                    let paragraph = event.target.lastElementChild;
                    paragraph.classList.remove("hidden-items");

                    let header = event.target.firstElementChild.nextElementSibling;
                    header.classList.add("active-text");

                    let image = event.target.firstElementChild;
                    image.classList.remove("hidden-items");
                    image.classList.add("active-hidden-img-portrait");

                    let form = event.target.parentNode.lastElementChild;
                    form.classList.remove("hidden-items");


                // Landscape
                } else {
                    // Other sections being hidden
                    let collapse = event.target.parentNode.parentNode;
                    let siblings = getSiblings(collapse);
                    for (let x = 0; x < siblings.length; x++) {
                        siblings[x].setAttribute("class", "col-md-1 store-item")

                        let hideElements = siblings[x].firstElementChild.firstElementChild;

                        let headerHide = hideElements.firstElementChild.nextElementSibling;
                        headerHide.classList.remove("active-text");
                        headerHide.classList.add("minimized-text");

                        let paragraphHide = hideElements.lastElementChild;
                        paragraphHide.classList.add("hidden-items")

                        let imageHide = hideElements.firstElementChild
                        imageHide.classList.add("hidden-items")

                        let formHide = hideElements.parentNode.lastElementChild
                            formHide.classList.add("hidden-items");
                        }
                    // Section being revealed/adjusted
                    collapse.setAttribute("class", "col-md-10 active-store-item");

                    let paragraph = event.target.lastElementChild;
                    paragraph.classList.remove("hidden-items");

                    let header = event.target.firstElementChild.nextElementSibling;
                    header.classList.add("active-text");
                    header.classList.remove("minimized-text")

                    let image = event.target.firstElementChild;
                    image.classList.remove("hidden-items")

                    let form = event.target.parentNode.lastElementChild
                    form.classList.remove("hidden-items");
                }
            });
        };

    </script>
{% endblock %}